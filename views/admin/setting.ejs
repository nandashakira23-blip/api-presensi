<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark': {
                            50: '#f8f9fa',
                            100: '#e9ecef',
                            200: '#dee2e6',
                            300: '#ced4da',
                            400: '#adb5bd',
                            500: '#6c757d',
                            600: '#495057',
                            700: '#343a40',
                            800: '#212529',
                            900: '#1a1d20',
                        },
                        'brown': {
                            50: '#faf8f5',
                            100: '#f0ebe4',
                            200: '#e4d5c7',
                            300: '#d4bfa6',
                            400: '#c4a882',
                            500: '#b8956b',
                            600: '#a67c52',
                            700: '#8b6914',
                            800: '#6d4c0f',
                            900: '#4a320a',
                        },
                        'coffee': {
                            50: '#faf9f7',
                            100: '#f0ede8',
                            200: '#e0d5c7',
                            300: '#d0bfa6',
                            400: '#c0a882',
                            500: '#a67c52',
                            600: '#8b6914',
                            700: '#6d4c0f',
                            800: '#4a320a',
                            900: '#2d1e06',
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Dark Theme Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #212529;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a67c52;
            border-radius: 4px;
            border: 1px solid #343a40;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b8956b;
        }
        .solid-background {
            background: #1a1d20;
        }
        .glow-brown {
            box-shadow: 0 2px 8px rgba(166, 124, 82, 0.2);
        }
        .glow-brown:hover {
            box-shadow: 0 4px 12px rgba(166, 124, 82, 0.3);
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(166, 124, 82, 0.3);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(33, 37, 41, 0.8);
            border: 1px solid rgba(166, 124, 82, 0.3);
        }
    </style>
    <!-- Google Maps tidak memerlukan CSS tambahan -->
</head>
<body class="bg-dark-900 min-h-screen solid-background">
    <%- include('../partials/navbar') %>

    <!-- Content with proper spacing for fixed navbar -->
    <div class="pt-16 sm:pt-20 lg:pt-20">
        <!-- Mobile menu spacing -->
        <div class="lg:hidden pt-16 sm:pt-20"></div>
        
        <!-- Sidebar & Content -->
        <div class="flex flex-col lg:flex-row">
            <%- include('../partials/sidebar', { currentPage: 'setting' }) %>

            <!-- Main Content with sidebar spacing -->
            <div class="flex-1 lg:ml-64 p-4 sm:p-6 lg:p-8 min-h-screen">
                <div class="mb-6 sm:mb-8">
                    <div class="flex items-center space-x-3 mb-2">
                        <div class="w-8 h-8 flex items-center justify-center">
                            <i class="fas fa-cog text-brown-400 text-xl"></i>
                        </div>
                        <h2 class="text-2xl sm:text-3xl font-bold text-white text-glow">Setting Lokasi</h2>
                    </div>
                    <p class="text-brown-300 text-sm sm:text-base">Konfigurasi titik koordinat dan radius area presensi</p>
                </div>

                <!-- Flash Messages -->
                <% if (success && success.length > 0) { %>
                    <div class="bg-green-900/80 border border-green-600/50 text-green-200 px-4 py-3 rounded-lg mb-4 shadow-lg backdrop-blur-sm fade-in">
                        <i class="fas fa-check-circle mr-2"></i><%= success %>
                    </div>
                <% } %>

                <% if (error && error.length > 0) { %>
                    <div class="bg-red-900/80 border border-red-600/50 text-red-200 px-4 py-3 rounded-lg mb-4 shadow-lg backdrop-blur-sm fade-in">
                        <i class="fas fa-exclamation-circle mr-2"></i><%= error %>
                    </div>
                <% } %>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 lg:gap-8">
                    <!-- Form Setting -->
                    <div class="bg-dark-800 rounded-xl shadow-2xl p-6 sm:p-8 border border-brown-600/30 card-hover glow-brown fade-in">
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-6 flex items-center text-glow">
                            <i class="fas fa-map-marker-alt text-brown-400 mr-3"></i>
                            Pengaturan Lokasi
                        </h3>
                        
                        <form method="POST" action="/admin/setting" class="space-y-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="lat_kantor" class="block text-sm font-semibold text-brown-300 mb-2">
                                        <i class="fas fa-crosshairs mr-2"></i>Latitude Kantor *
                                    </label>
                                    <input type="number" id="lat_kantor" name="lat_kantor" step="0.00000001" required
                                           value="<%= setting.lat_kantor %>"
                                           class="w-full px-4 py-3 bg-dark-700 border border-brown-600/50 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-brown-400 transition duration-200 text-white placeholder-brown-400"
                                           placeholder="Contoh: -8.8155675">
                                </div>

                                <div>
                                    <label for="long_kantor" class="block text-sm font-semibold text-brown-300 mb-2">
                                        <i class="fas fa-crosshairs mr-2"></i>Longitude Kantor *
                                    </label>
                                    <input type="number" id="long_kantor" name="long_kantor" step="0.00000001" required
                                           value="<%= setting.long_kantor %>"
                                           class="w-full px-4 py-3 bg-dark-700 border border-brown-600/50 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-brown-400 transition duration-200 text-white placeholder-brown-400"
                                           placeholder="Contoh: 115.1253343">
                                </div>
                            </div>

                            <div>
                                <label for="radius_meter" class="block text-sm font-semibold text-brown-300 mb-2">
                                    <i class="fas fa-circle-notch mr-2"></i>Radius Area (Meter) *
                                </label>
                                <input type="number" id="radius_meter" name="radius_meter" min="1" required
                                       value="<%= setting.radius_meter %>"
                                       class="w-full px-4 py-3 bg-dark-700 border border-brown-600/50 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-brown-400 transition duration-200 text-white placeholder-brown-400"
                                       placeholder="Contoh: 100">
                                <p class="text-sm text-brown-400 mt-2 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Radius akan ditampilkan sebagai lingkaran merah di peta
                                </p>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex flex-col gap-3">
                                <button type="button" onclick="getCurrentLocation()" 
                                        class="w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
                                    <i class="fas fa-location-arrow mr-2"></i>Gunakan Lokasi Saat Ini
                                </button>
                                <button type="submit" 
                                        class="w-full bg-brown-600 hover:bg-brown-500 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
                                    <i class="fas fa-save mr-2"></i>Simpan Pengaturan
                                </button>
                            </div>
                            
                            <div class="bg-blue-900/30 border border-blue-600/50 rounded-lg p-4">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-info-circle text-blue-400 mt-1"></i>
                                    <div class="text-sm text-blue-200">
                                        <strong>Cara Update Lokasi:</strong>
                                        <ul class="mt-2 space-y-1 list-disc list-inside">
                                            <li>Klik di peta untuk set lokasi baru</li>
                                            <li>Atau drag marker merah ke posisi yang diinginkan</li>
                                            <li>Koordinat akan otomatis update</li>
                                            <li>Klik "Simpan Pengaturan" untuk menyimpan</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Map Preview -->
                    <div class="bg-dark-800 rounded-xl shadow-2xl p-6 sm:p-8 border border-brown-600/30 card-hover glow-brown fade-in" style="animation-delay: 0.1s;">
                        <h3 class="text-xl sm:text-2xl font-bold text-white mb-6 flex items-center text-glow">
                            <i class="fas fa-map text-brown-400 mr-3"></i>
                            Preview Lokasi
                        </h3>
                        
                        <div class="space-y-4">
                            <!-- Search Location -->
                            <div class="relative">
                                <label for="search-location" class="block text-sm font-semibold text-brown-300 mb-2">
                                    <i class="fas fa-search mr-2"></i>Cari Lokasi
                                </label>
                                <input type="text" id="search-location" 
                                       class="w-full px-4 py-3 pl-10 bg-dark-700 border border-brown-600/50 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-brown-400 transition duration-200 text-white placeholder-brown-400"
                                       placeholder="Cari alamat, nama tempat, atau landmark...">
                                <i class="fas fa-search absolute left-3 top-12 text-brown-400"></i>
                            </div>
                            
                            <!-- Interactive Map -->
                            <div id="map" class="bg-dark-600 rounded-lg h-64 sm:h-80 lg:h-96 border border-brown-600/50 shadow-inner"></div>
                            
                            <!-- Quick Update Button -->
                            <button type="button" onclick="quickUpdateLocation()" 
                                    class="w-full bg-gradient-to-r from-brown-600 to-brown-500 hover:from-brown-500 hover:to-brown-400 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                                <i class="fas fa-map-marked-alt mr-2"></i>Update Lokasi dari Peta
                                <div class="text-xs mt-1 opacity-90">Klik/Drag marker di peta, lalu klik tombol ini</div>
                            </button>
                            
                            <!-- Map Info -->
                            <div class="bg-brown-800/50 p-4 rounded-lg border border-brown-600/50 backdrop-blur-sm">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div class="font-semibold text-white mb-1">Koordinat</div>
                                        <div class="text-brown-300 space-y-1">
                                            <div class="flex justify-between">
                                                <span>Lat:</span>
                                                <span id="current-lat" class="font-mono text-xs text-brown-200"><%= setting.lat_kantor %></span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>Lng:</span>
                                                <span id="current-lng" class="font-mono text-xs text-brown-200"><%= setting.long_kantor %></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-white mb-1">Radius Area</div>
                                        <div class="text-brown-300">
                                            <span id="current-radius" class="text-lg font-bold text-brown-200"><%= setting.radius_meter %></span> meter
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <a href="https://www.google.com/maps?q=<%= setting.lat_kantor %>,<%= setting.long_kantor %>" 
                                   target="_blank" 
                                   class="bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center shadow-md hover:shadow-lg text-sm">
                                    <i class="fas fa-external-link-alt mr-2"></i>
                                    Google Maps
                                </a>
                                <button type="button" onclick="resetToDefault()" 
                                        class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center shadow-md hover:shadow-lg text-sm">
                                    <i class="fas fa-undo mr-2"></i>
                                    Reset Default
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Maps JavaScript API -->
    <script>
        // Handle Google Maps authentication failure BEFORE loading the API
        function gm_authFailure() {
            console.error('Google Maps authentication failed - Invalid API key or restrictions');
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-400 p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <div class="text-lg font-semibold mb-2">Google Maps Authentication Failed</div>
                        <div class="text-sm text-brown-300 mb-4">
                            API key tidak valid atau ada pembatasan akses.<br>
                            Silakan periksa konfigurasi Google Maps API key.
                        </div>
                        <div class="text-xs text-brown-400 bg-dark-700 p-3 rounded border border-brown-600/50 max-w-md">
                            <div class="font-semibold mb-2">Solusi:</div>
                            <ol class="text-left list-decimal list-inside space-y-1">
                                <li>Periksa API key di file .env</li>
                                <li>Pastikan Maps JavaScript API enabled</li>
                                <li>Cek API restrictions di Google Cloud Console</li>
                                <li>Pastikan billing account aktif</li>
                            </ol>
                        </div>
                    </div>
                `;
            }
        }
    </script>
    
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=<%= GOOGLE_MAPS_API_KEY %>&libraries=places&callback=initMap"
        onerror="handleMapLoadError()">
    </script>

    <script>
        // Initialize map
        let map;
        let marker;
        let circle;
        
        // Current settings
        let currentLat = <%= setting.lat_kantor %>;
        let currentLng = <%= setting.long_kantor %>;
        let currentRadius = <%= setting.radius_meter %>;

        function initMap() {
            try {
                console.log('Initializing Google Maps with coordinates:', currentLat, currentLng);
                console.log('API Key present:', '<%= GOOGLE_MAPS_API_KEY %>'.substring(0, 10) + '...');
                
                // Check if Google Maps is loaded
                if (typeof google === 'undefined' || !google.maps) {
                    console.error('Google Maps library not loaded');
                    showMapError('Google Maps library gagal dimuat. Periksa koneksi internet atau API key.');
                    return;
                }

                const center = { lat: currentLat, lng: currentLng };

                // Create map
                map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 16,
                    center: center,
                    mapTypeId: 'roadmap',
                    styles: [
                        {
                            "featureType": "all",
                            "elementType": "geometry",
                            "stylers": [{"color": "#242f3e"}]
                        },
                        {
                            "featureType": "all",
                            "elementType": "labels.text.stroke",
                            "stylers": [{"lightness": -80}]
                        },
                        {
                            "featureType": "administrative",
                            "elementType": "labels.text.fill",
                            "stylers": [{"color": "#746855"}]
                        },
                        {
                            "featureType": "poi",
                            "elementType": "labels.text.fill",
                            "stylers": [{"color": "#d59563"}]
                        },
                        {
                            "featureType": "water",
                            "elementType": "geometry",
                            "stylers": [{"color": "#17263c"}]
                        }
                    ]
                });

                // Add marker for office location
                marker = new google.maps.Marker({
                    position: center,
                    map: map,
                    title: 'Lokasi Kantor Fleur Atelier',
                    draggable: true,
                    animation: google.maps.Animation.DROP
                });

                // Create radius circle
                createCircle(center, currentRadius);

                // Initialize Places Autocomplete
                const searchInput = document.getElementById('search-location');
                const autocomplete = new google.maps.places.Autocomplete(searchInput, {
                    fields: ['geometry', 'name', 'formatted_address'],
                    componentRestrictions: { country: 'id' } // Restrict to Indonesia
                });

                // When user selects a place from autocomplete
                autocomplete.addListener('place_changed', function() {
                    const place = autocomplete.getPlace();
                    
                    if (!place.geometry || !place.geometry.location) {
                        alert('Lokasi tidak ditemukan. Coba kata kunci lain.');
                        return;
                    }

                    const location = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };

                    // Move marker and map to selected location
                    setMarkerAndCircle(location);
                    map.setZoom(17);
                    
                    console.log('Location selected:', place.name, location);
                });

                // Event listener for marker drag
                marker.addListener('dragend', function() {
                    const newPos = marker.getPosition();
                    const newLat = newPos.lat();
                    const newLng = newPos.lng();
                    
                    console.log('Marker moved to:', newLat, newLng);
                    
                    // Update form values
                    document.getElementById('lat_kantor').value = newLat;
                    document.getElementById('long_kantor').value = newLng;
                    
                    // Update display
                    document.getElementById('current-lat').textContent = newLat.toFixed(8);
                    document.getElementById('current-lng').textContent = newLng.toFixed(8);
                    
                    // Update circle position
                    updateCirclePosition();
                });

                // Event listener for map click
                map.addListener('click', function(event) {
                    const clickedLocation = {
                        lat: event.latLng.lat(),
                        lng: event.latLng.lng()
                    };
                    setMarkerAndCircle(clickedLocation);
                });

                console.log('Google Maps initialized successfully');

            } catch (error) {
                console.error('Error initializing Google Maps:', error);
                showMapError('Error: ' + error.message);
            }
        }
        
        function showMapError(message) {
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-400 p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                        <div class="text-sm">${message}</div>
                    </div>
                `;
            }
        }
        
        function handleMapLoadError() {
            console.error('Failed to load Google Maps script');
            showMapError('Gagal memuat Google Maps. Periksa koneksi internet.');
        }

        function createCircle(center, radius) {
            // Remove old circle if exists
            if (circle) {
                circle.setMap(null);
            }

            // Create new circle
            circle = new google.maps.Circle({
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.2,
                map: map,
                center: center,
                radius: radius
            });
        }

        function setMarkerAndCircle(location) {
            marker.setPosition(location);
            map.setCenter(location);
            
            // Update form values
            document.getElementById('lat_kantor').value = location.lat;
            document.getElementById('long_kantor').value = location.lng;
            
            // Update display
            document.getElementById('current-lat').textContent = location.lat.toFixed(8);
            document.getElementById('current-lng').textContent = location.lng.toFixed(8);
            
            updateCirclePosition();
        }

        function updateCirclePosition() {
            const radius = parseInt(document.getElementById('radius_meter').value) || currentRadius;
            const center = marker.getPosition();
            
            // Update display
            document.getElementById('current-radius').textContent = radius;
            
            createCircle({ lat: center.lat(), lng: center.lng() }, radius);
        }

        function showCoordinates(lat, lng) {
            console.log('Current coordinates:', lat, lng);
            document.getElementById('current-lat').textContent = lat.toFixed(8);
            document.getElementById('current-lng').textContent = lng.toFixed(8);
        }

        function resetToDefault() {
            const defaultLat = -8.8155675;
            const defaultLng = 115.1253343;
            const defaultRadius = 100;
            
            document.getElementById('lat_kantor').value = defaultLat;
            document.getElementById('long_kantor').value = defaultLng;
            document.getElementById('radius_meter').value = defaultRadius;
            
            const defaultLocation = { lat: defaultLat, lng: defaultLng };
            setMarkerAndCircle(defaultLocation);
            
            alert('Lokasi direset ke FLEUR Caf√© Bali');
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        setMarkerAndCircle(userLocation);
                        alert('Lokasi berhasil dideteksi! Klik "Update Lokasi dari Peta" untuk menyimpan.');
                    },
                    function(error) {
                        alert('Gagal mendapatkan lokasi: ' + error.message);
                    }
                );
            } else {
                alert('Browser tidak mendukung geolocation');
            }
        }

        // Quick update location - submit form with current map coordinates
        function quickUpdateLocation() {
            const lat = document.getElementById('lat_kantor').value;
            const lng = document.getElementById('long_kantor').value;
            const radius = document.getElementById('radius_meter').value;
            
            if (!lat || !lng || !radius) {
                alert('Koordinat atau radius tidak valid');
                return;
            }
            
            // Confirm before saving
            if (confirm(`Update lokasi ke:\nLatitude: ${parseFloat(lat).toFixed(8)}\nLongitude: ${parseFloat(lng).toFixed(8)}\nRadius: ${radius} meter\n\nLanjutkan?`)) {
                // Submit the form
                document.querySelector('form[action="/admin/setting"]').submit();
            }
        }

        // Handle Google Maps authentication failure
        function gm_authFailure() {
            console.error('Google Maps authentication failed');
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-400 p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <div class="text-lg font-semibold mb-2">Google Maps Authentication Failed</div>
                        <div class="text-sm text-brown-300">API key tidak valid atau ada pembatasan akses</div>
                    </div>
                `;
            }
        }

        // Update radius when input changes
        document.addEventListener('DOMContentLoaded', function() {
            const radiusInput = document.getElementById('radius_meter');
            if (radiusInput) {
                radiusInput.addEventListener('input', function() {
                    if (circle && marker) {
                        updateCirclePosition();
                    }
                });
            }
        });

        // Real-time Clock - Consistent format (date and time only)
        function updateClock() {
            try {
                const now = new Date();
                const options = {
                    day: '2-digit',
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'Asia/Makassar' // WITA timezone
                };
                
                const timeString = now.toLocaleString('id-ID', options);
                const clockElement = document.getElementById('currentTime');
                
                if (clockElement) {
                    clockElement.textContent = timeString;
                }
            } catch (error) {
                console.error('Clock update error:', error);
                // Fallback to simple time format
                const clockElement = document.getElementById('currentTime');
                
                if (clockElement) {
                    const now = new Date();
                    const day = String(now.getDate()).padStart(2, '0');
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const year = now.getFullYear();
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');
                    clockElement.textContent = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
                }
            }
        }

        // Update clock immediately and then every second
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing clock...');
            const clockElement = document.getElementById('currentTime');
            
            if (clockElement) {
                console.log('Clock element found, starting updates...');
                updateClock();
                setInterval(updateClock, 1000);
            } else {
                console.log('Clock element not found, trying again...');
                // Try again after a short delay
                setTimeout(function() {
                    const clockElement = document.getElementById('currentTime');
                    
                    if (clockElement) {
                        console.log('Clock element found on retry, starting updates...');
                        updateClock();
                        setInterval(updateClock, 1000);
                    } else {
                        console.log('Clock element still not found after retry');
                    }
                }, 500);
            }
        });
    </script>
</body>
</html>